# 1.7 Dates & Time

```js
// We'll cover what this code means in the D3.js section :-)
import {utcParse,utcFormat} from "d3-time-format";
```

<p class="cite_small">
  Some content below is reused and modified from <a href="https://tc39.es/proposal-temporal/docs/" target="_blank" rel="noopenner noreferrer">JavaScript's official API documentation</a>.
</p>

## Start Your GH Workflow

Remember, before you start anything else, always follow this GH methodological workflow:

1. Create meaningful **branch** that uses the agreed upon naming scheme: `CHP/X.x--lastname`.
2. Practice the iterative process to **commit** and **push** regularly with meaningful **commit messages**.

## Overview

**Dates and time** are very special types of data type in all programming languages. The datetime object is often tricky to use, change, transform, and "clean" in your data. So, we need to take an entire chapter to cover the basics, because there's no escaping them.

JS actually has a very brand new specification for date objects called `Temporal`, so we're going to learn it together, so we are future-ready.

## 1.7.1 Standardizing Dates & Time

It took us — us, as a global society — awhile to standardize dates as programmable data object. The JS Temporal date object follows the *International Standard Organizations* (ISO) [ISO 8601 standard](https://www.iso.org/iso-8601-date-and-time-format.html) that maintains the ability to represent and process dates and time.

As per the ISO 8601, the data standard can be used by anyone who wants to use a standardized way of presenting:

- Date
- Time of day
- Coordinated Universal Time (UTC)
- Local time with offset to UTC
- Date and time
- Time intervals
- Recurring time intervals

The JS Temporal API nicely visualizes how it follows the ISO 8601 standard by supporting the ability to create a Temporal data object from a String in the following format with an exacting sequence of information shown below:

![](./../assets/images/1-js/dates-persistence-model.svg)

## 1.7.2 Temporal objects

Let's practice making datetime objects with Temporal. Open your browser's console as you read through this section.

### How to get the current date and time in the local time zone?

```javascript
/**
 * Get the current date in JavaScript
 * This is a popular question on Stack Overflow for dates in JS
 * https://stackoverflow.com/questions/1531093/how-do-i-get-the-current-date-in-javascript
 *
 */

const dateNow = Temporal.Now.plainDateISO() // Gets the current date

// If you additionally want the date AND time:
const dateSuperNow = Temporal.Now.plainDateTimeISO()
```

```js
const dateSuperNow = Temporal.Now.plainDateTimeISO()
```

Make sure to review just how much information -- ***data*** -- is stored, as well as how many methods are available with every single Temporal object.

<p class="codeblock-caption">
  Output of <code>dateSuperNow</code> will change.
</p>

```js
dateSuperNow
```

<p class="codeblock-caption">
  Output of <code>dateSuperNow.dayOfYear</code> will change.
</p>

```js
dateSuperNow.dayOfYear
```

### `.toString()` Convert Temporal object to a String

If you additionally want the time, then you can chain methods by first using `.plainDateTimeISO()`. Then, you can can convert the Date & Time ISO object to an ISO 8601 compliant string with `.toString()`.

```javascript
// date and time in ISO 8601 format
const stringISODateTime = Temporal.Now.plainDateTimeISO().toString()
```

<p class="codeblock-caption">
  If you refresh your browser, this output of <code>stringISODateTime</code> will change.
</p>

```js
const stringISODateTime = Temporal.Now.plainDateTimeISO().toString()
```

```js
stringISODateTime
```

When I wrote this chapter, I assigned the following date and time data as a string to `stringDateTime`: `"2025-07-17T09:51:42.651"`. Here it is broken down by the chained methods to `Temporal.Now`:

1. `.plainDateTimeISO()` == `Temporal.PlainDateTime 2025-07-17T09:51:42.651`
2. `.toString()` == `"2025-07-17T09:51:42.651"`

### Access particular parts of Temporal object

Try out the following quick methods to retrieve particular parts of the Temporal object saved in you console. Based on my example above, here's the outputs generated by particular useful methods:

| Method | Retrieved | Output  |
|--------|-------------|---------|
| `stringDateTime.year`  | year as a Number. | `2025`|
| `stringDateTime.month`  | month as a Number. | `7`|
| `stringDateTime.day`  | day of month as a Number. | `17`|
| `stringDateTime.dayOfWeek`  | day of week as a Number. | `4`|
| `stringDateTime.dayOfYear`  | day of year as a Number. | `198`|
| `stringDateTime.weekOfYear`  | week number of the year as a Number. | `29`|
| `stringDateTime.hour`  | hour as a Number. | `9`|
| `stringDateTime.minute`  | minute as a Number. | `51`|
| `stringDateTime.second`  | second as a Number. | `42`|
| `stringDateTime.millisecond`  | millisecond as a Number. | `651`|
| `stringDateTime.microsecond`  | microsecond as a Number. | `0`|
| `stringDateTime.nanosecond`  | nanosecond as a Number. | `0`|

### More Temporal object conversions

| Method | Conversion | Output  |
|--------|------------|---------|
| `stringDateTime.toPlainDate()`  | Temporal.PlainDate object. YYYY-MM-DD. | `2025-07-17`|
| `stringDateTime.toPlainTime()`  | Temporal.PlainTime object. HH:MM:SS.mmm. | `09:51:42.651`|
| `stringDateTime.toLocaleString()`  | String. Converts to locally situated method of formatting dates. In the U.S., it is: m/d/YYYY, h:m:s AM/PM. | `"7/17/2025, 9:51:42 AM"`|

### Converting between data types

Let's start a new running Temporal object example in your console:

```javascript
let dateString = "2025-07-17"
```

Here are some ways to convert the String data assigned to `dateString` to a `Temporal` object.

| OG Type | Conversion | Output  |
|---------|------------|---------|
| String: `dateString` as `"2025-07-17"`  | `let plainDate = Temporal.PlainDate.from(dateString)`  | Temporal.PlainDate `2025-07-17`|
| `plainDate` as Temporal PlainDate `2025-07-17`.<br><br>But need Time too.  | *Using midnight hour as default is a common move during data processing and analysis work, when the time info is missing*.<br><br>`let dateTime = datePD.toPlainDateTime(Temporal.PlainTime.from({ hour: 12 }))`  | Temporal.PlainDateTime `2025-07-17T12:00:00`|

## 1.7.3 Working with dates in D3.js

We will also use the D3.js code library to work with dates, because it is honestly really helpful and sometimes easier than JavaScript's built-in methods. Here are some very helpful and frequently used methods.

But, first, you always need to import the library, which I already have done on this page. We are only going to import two methods from the D3.js library:

1. [utcParse()](https://d3js.org/d3-time-format#locale_utcParse) -- Parses a `String` and can customize the format of the expected input `String` value.
2. [utcFormat()](https://d3js.org/d3-time-format#locale_format) -- Parses Date object and given a set of "specifiers", you can custom an output format.

### Importing D3.js time methods

To use external JS methods, you need to import code libraries, sometimes also called modules or packages, from external sources.

Remember the NPM (Node Package Manager) and Yarn tools that I made you install? Those tools help people manage external ***dependencies*** like the many available from the D3.js community. We are using Yarn.

You can see what dependencies are currently expected and used in this project's `package.json` file, which I provide in the below excerpt. You can see Observable's there, as well as some libraries from D3.js.

```json
...
"dependencies": {
  "@observablehq/framework": "^1.13.2",
  "csv": "^6.4.1",
  "d3-dsv": "^3.0.1",
  "d3-fetch": "^3.0.1",
  "d3-time-format": "^4.1.0",
  "fs": "^0.0.1-security",
  "highlight.js": "^11.11.1"
},
...
```

If I ever need to add or remove dependencies from the project, I can use the following `yarn` commands in the terminal, making sure that I am in the root folder of the project:

```bash
yarn add enterPackageName

yarn remove enterPackageName
```

### Import dependencies in JS files

To use the dependencies, i.e., other peoples' code in our project, we need to import them. Depending upon what programming language environment and technology stack you are using, there are different ways to do so. In our case, we will use the following approach with an `import` `from` expression.

```javascript
/**
  * Tells Observable Framework and Node.js
  * to import two methods from D3.js'
  * library that specializes in datetime objects
**/
import {utcParse,utcFormat} from "d3-time-format";

// If I want to import all methods from d3-time-format
import * from "d3-time-format";
```

Now, since it has been imported into our programming environment, we can use any selected or all of the methods and functions provided in the code library. Below, we learn how to use two very common methods: `utcParse` and `utcFormat`.

### d3.utcParse(): Convert strings into dates

Unfortunately, date data often create headaches. One set will use one format; another set will use another. Hopefully, one of the sets uses a reasonable format!

To deal with the diverse ways dates may be formatted in your data, we can use D3.js' utcParse() method. Here's how it works with the `nc2024SampleVoters` data, which uses the `MM/DD/YYYY` format, e.g., `"10/23/2024"`. We can create a custom date parser, which will convert the String version into a Date object for easier use.

Here's how:

1. Declare a new D3 parser object with its own built-in methods. Notice how the utcParse() accepts a String parameter that includes expected "identifiers" delimited by the `%` sign, each of which represent parts of a date:
    ```javascript
    /** utcParse()
      * Write an abstracted form of the data format
      * pattern used in your data with identifiers
      * %d == zero-padded day of the month as a decimal number [01,31].
      * %m == month as a decimal number [01,12].
      * %Y == year with century as a decimal number, such as 1999.
    **/

    const parseDateSlash = utcParse("%d/%m/%Y")
    ```
2. Use the parser assigned to `parseDateSlash` to convert dates into a JS Date() object that follow the set's particular format, but are currently Strings.
    ```javascript
    // Result: Date Sun Nov 09 2025 19:00:00 GMT-0500 (Eastern Standard Time)
    parseDateSlash(nc2024SampleVoters[0].ballot_req_dt)
    ```
3. That's it! `:-)`

### d3.utcFormat(): Convert Date objects into strings

Do you need to display some date in a particular way? Ok, use D3.js' `utcFormat()`.

Use the same identifier schemes, but convert a Date object into whatever available unit of the date info needed. Let's declare some parsers and a Date object to demo:

```javascript
// D3 Parsers
const formatYear = utcFormat("%Y")
const formatDayOfMonth = utcFormat("%d")
const formatMonth = utcFormat("%m")
const formatPrettyDate = utcFormat("%a, %b %d %Y")

// Date object to demo
const dateObject = new Date("2024-10-24T19:00:00.000")
```

Here are some examples in the table below.

| Conversion | Output  |
|------------|---------|
| `formatYear(dateObject)`  | String. `2024`|
| `formatDayOfMonth(dateObject)`  | String. `24`|
| `formatMonth(dateObject)`  | String. `10`|
| `formatPrettyDate(dateObject)`  | String. `Thu, Oct 24 2024`|

<!-- D3 parsers -->
```js
// D3 Parsers
// Converters
const parseDateHyphen = utcParse("%d-%m-%Y")
const parseDateSlash = utcParse("%d/%m/%Y")

// Formatters
const formatYear = utcFormat("%Y")
const formatDayOfMonth = utcFormat("%d")
const formatMonth = utcFormat("%m")
const formatPrettyDate = utcFormat("%a, %b %d %Y")
```

```js
// Date object to demo
const dateObject = new Date("2024-10-24T19:00:00.000")
console.log(
  "PRACTICE FORMATTING",
  "\ndateObject:",dateObject,
  "\nformatYear:", formatYear(dateObject),
  "\nformatDayOfMonth:", formatDayOfMonth(dateObject),
  "\nformatMonth:", formatMonth(dateObject),
  "\nformatPrettyDate:", formatPrettyDate(dateObject),
)
```

## Exercises with Date Objects

Below, I have assigned a tiny sample of 4 randomly selected abridged entries from NC November 2024 absentee voter data to the variable `nc2024SampleVoters`. It is declared as an Array of JS Objects, where each object is a voter in NC. Note how there are a few properties with date information saved as Strings:

1. `ballot_req_dt`: Ballot Request Date
2. `ballot_send_dt`: Date ballot sent to voter
3. `ballot_rtn_dt`: Date ballot returned to NC

Take a moment to review the data below in the interactive output.

<!-- Assign nc2024SampleVoters -->
```js
// Sample of 4 randomly selected abridged entries from NC November 2024 absentee voter data
let nc2024SampleVoters = [
  {
    "race": "WHITE",
    "ethnicity": "NOT HISPANIC or NOT LATINO",
    "gender": "F",
    "age": 33,
    "ballot_req_type": "MAIL",
    "ballot_request_party": "REP",
    "ballot_req_dt": "10/23/2024",
    "ballot_send_dt": "10/28/2024",
    "ballot_rtn_dt": null,
    "ballot_rtn_status": null
  },
  {
    "race": "BLACK or AFRICAN AMERICAN",
    "ethnicity": "UNDESIGNATED",
    "gender": "F",
    "age": 57,
    "ballot_req_type": "MAIL",
    "ballot_request_party": "DEM",
    "ballot_req_dt": "09/14/2024",
    "ballot_send_dt": "09/23/2024",
    "ballot_rtn_dt": "10/28/2024",
    "ballot_rtn_status": "SPOILED-EV"
  },
  {
    "race": "WHITE",
    "ethnicity": "NOT HISPANIC or NOT LATINO",
    "gender": "M",
    "age": 21,
    "ballot_req_type": "MAIL",
    "ballot_request_party": "UNA",
    "ballot_req_dt": "09/19/2024",
    "ballot_send_dt": "09/21/2024",
    "ballot_rtn_dt": "10/24/2024",
    "ballot_rtn_status": "ACCEPTED"
  },
  {
    "race": "WHITE",
    "ethnicity": "UNDESIGNATED",
    "gender": "F",
    "age": 32,
    "ballot_req_type": "MAIL",
    "ballot_request_party": "DEM",
    "ballot_req_dt": "08/03/2024",
    "ballot_send_dt": "09/24/2024",
    "ballot_rtn_dt": null,
    "ballot_rtn_status": "SPOILED-EV"
  }
]
```

<p class="codeblock-caption">
  Interactive output of <code>nc2024SampleVoters</code>
</p>

```js
nc2024SampleVoters
```

### E1. d3.utcParse(): Convert string dates to Date() objects

**Goal**: Use `.map()` to loop through the array of objects, `nc2024SampleVoters`, and create a new array of objects called `ballotsWithDateObjs`. In the new array of objects, assign a converted version of the String dates for `ballot_req_dt` to a Date() object with a new property with the key named `ballot_req_dt_obj`.

Here are some tips to consider as you complete this exercise.

<p class="tip"></strong>Accessing object properties</strong>: Access an object's properties with either dot notation, <code>nc2024SampleVoters.ballot_req_dt</code>, or by the square-bracket method, <code>nc2024SampleVoters["ballot_req_dt"]</code>.</p>
<p class="tip"><strong>Read your data</strong>: When working with new data, one great first move, among more we'll learn later, is to read the data by logging it to the web browser console. In Observable notebooks, we can simply output the variable of choice interactively to the page by placing it alone in a js codeblock like above.</p>
<p class="tip"><strong>Isolate interested parts of data</strong>: If dates are important to the inquiry, remember that the dates are stored as Strings in the following format: <code>"10/24/2024"</code>, i.e.,<code>"mm/dd/YYYY"</code>.</p>

<!-- E1 -->
```javascript
// Convert and code here
```

```javascript
// Convert and output
ballotsWithDateObjs
```

### E2. d3.utcFormat(): Convert & format Date() object to String

**Goal**: Use `.map()` to loop through the updated array of objects, `ballotsWithDateObjs`, and create a new array of objects called `updatedBallots`. In the new `updatedBallots`, use `d3.utcFormat()` to assign a converted and formatted version of `ballot_req_dt_obj` with the following date ***format***: Wed., January 27, 1981.

<!-- E2 -->
```javascript
// Convert and code here
```

```javascript
// Convert and output updatedBallots here
updatedBallots
```

## Submission

1. Create a **PR** (**pull request**) and use the provided content in the template to start it.
2. Respond to your peers and comment on their work on at least one chapter..
3. Submit the PR link in Moodle, when you're ready.
